---
title: "Prelim_Spring2019"
author: "Sarah Glancy"
date: "2/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
when importing data set, change mmLenght, Total_prey and Total_gut to numeric values
 how to change row names after import
 
```{r}
library(readxl)
Spring2019 <- read_excel("C:/Users/Sarah/Desktop/WHOI/LTER/201902/LTER201902_FishGuts.xlsx", 
    col_types = c("numeric", "numeric", "text", 
        "numeric", "text", "text", "text", 
        "text", "text", "text", "numeric", 
        "text", "numeric", "numeric", "text", 
        "text"))
View(Spring2019)
```
 
 
 Warnings in above are from the NAs in the numeric columns
 
 Spring2019 %>% 
  rename(
    Length(mm) = mmLength )

```{r}


kable(Spring2019)
```

I need to seperate this table into two, one that has unique identifiers for prey and another that had fish with counts from each prey type it contains. 

selecting out specific rows and then naming a new data file with just those rows in them. 
Example: portland_flights <- flights %>% 
            filter(dest == "PDX")
            View(portland_flights)
```{r}
FishCount <- Spring2019 %>% 
  filter(Total_prey != "NA") %>%
           filter(GutItem != "Parasite")
View(FishCount)

```

create another data table with only the rows that have unique prey ID with measurements 
```{r}

PreyMeas <- Spring2019 %>% 
  filter(Prey_mm != "NA")
View(PreyMeas)
```

finally create table that has parasite info- will be remainder of rows. 

```{r}
Parasites <- Spring2019 %>% 
  filter(GutItem == "Parasite")
View(Parasites)

```

Starting some analysis

n() counts the number of ROWS in each each group

```{r}

by_FSpecies <- Spring2019 %>% 
  group_by(FishSpecies) %>% 
  summarize(count = n())
by_FSpecies
```

###
start attempting data summarizing

```{r}

summary_FishSp_TotGut <- Spring2019 %>% 
  group_by(FishSpecies) %>% 
  summarize(mean = mean(Total_gut, na.rm = TRUE))
summary_FishSp_TotGut
```
 there is a misspelling where one is capatilized in P_tri attempting to change to all match
 
```{r}
install.packages(mudata2)

recode(Spring2019$FishSpecies, p_tri = "P_tri" )

summary_FishSp_TotGut <- Spring2019 %>% 
  group_by(FishSpecies) %>% 
  summarize(mean = mean(Total_gut, na.rm = TRUE))

summary_FishSp_TotGut
```
 rename the "mean" column
 
```{r}

rename (summary_FishSp_TotGut, "Mean prey items" = "mean")

summary_FishSp_TotGut
```
```{r}
print(summary_FishSp_TotGut)
```
more specific groupings
```{r}
summary_FishSp_preytype <- PreyMeas %>% 
  group_by(GutItem) %>%
  summarize(mean = mean(Prey_mm, na.rm = TRUE))

 summary_GutItem <- summary_FishSp_preytype
 
 summary_GutItem
```
requires renaming or "recoding" some of the variables again. 

```{r}

recode(FishCount$GutItem, candacia = "Candacia", polychaeta ="polychaeta" )

summary_GutItem

```
count the number of fish for each species. might need to create a uniqie identifier for each fish??

data(brussels_reviews_anno)
x <- brussels_reviews_anno
x$doc_sent_id <- unique_identifier(x, fields = c("doc_id", "sentence_id"))
head(x, 15)
range(x$doc_sent_id)
x$doc_sent_id <- unique_identifier(x, fields = c("doc_id", "sentence_id"), start_from = 10)
head(x, 15)
range(x$doc_sent_id)

```{r}
install.packages("udpipe")
Spring2019$FishUniq <- unique_identifier(Spring2019, fields = c("Cruise", "Station", "FishSpecies", "FishNum"))

head(Spring2019, 15)

range(Spring2019$FishUniq)

 Spring2019 %>%
   count(Cruise, Station, FishSpecies, FishNum )

```
created a column of unique identifiers, but the total is not equal to the number of fish sampled. 
```{r}

by_FSpecies <- Spring2019 %>% 
  group_by(FishUniq) %>% 
  summarize(count = n())
by_FSpecies

summary(Spring2019$FishUniq)
```
making a smaller tibble and then joining later using my new unique identifier

```{r}

NoPrey_table <-  Spring2019 %>% 
  distinct(FishSpecies, Station, FishNum, .keep_all = TRUE) %>%
  count(FishSpecies)

Spring2019 %>%
  count(FishSpecies, Station, FishNum)
  
NoPrey_table
```

there are still dumplicates, i'll try to find out of it is the station that is somehow not unique
```{r}
recode(FishCount$FishSpecies, p_tri = "P_tri" )

##recode(Spring2019$FishSpecies, p_tri = "P_tri" ) ## this worked above, why not here

Summary_FishCount <- Spring2019 %>% 
  group_by(FishSpecies) %>%
  summarize(count = n())

 Summary_FishCount
```
group by and then mutate to add variable to use for statistics
split to create a new dataframe
long to wide transformation?
```{r}
Spring2019_wide <- Spring2019 %>%
  pivot_wider(
  id_cols = FishSpecies,
  names_from = FishUniq,
  names_prefix = "",
  names_sep = "_",
  names_glue = NULL,
  names_sort = FALSE,
  names_repair = "check_unique",
  values_from = Total_gut,
  values_fill = NULL,
  values_fn = NULL
)

Spring2019 %>%
  pivot_wider(id_cols = FishSpecies, 
              names_from = FishUniq,
              values_from = Total_gut
              
              )

```

```{r}
Spring2019 %>%
  select(FishUniq, FishSpecies, Station) %>%
  group_by(FishUniq, FishSpecies) %>%
  count()


  
```

